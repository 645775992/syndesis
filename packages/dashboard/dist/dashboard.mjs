import{AggregateStatusCount as t,AggregateStatusNotification as n,AggregateStatusNotifications as r,Card as e,Icon as i,EmptyState as o,CardGrid as s,ProgressBar as a,ListView as l,Label as p,Spinner as u,DropdownKebab as c,MenuItem as h,DonutChart as d,patternfly as g,Grid as y}from"patternfly-react";import{createElement as f,PureComponent as m,Component as x,Fragment as w}from"react";import b from"react-content-loader";import{getConnectionIcon as C}from"@syndesis/utils";import{Link as v}from"react-router-dom";import{WithConnections as S,WithIntegrationsMetrics as I,WithMonitoredIntegrations as P}from"@syndesis/api";import{Route as _,Switch as k}from"react-router";var D=function(t,n){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(t,n)};function N(t,n){function r(){this.constructor=t}D(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var O=function(){return(O=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var i in n=arguments[r])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},R=function(t,n){return(R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(t,n)};function T(t,n){function r(){this.constructor=t}R(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var L=function(){return(L=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var i in n=arguments[r])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},A=function(o){function s(){return null!==o&&o.apply(this,arguments)||this}return T(s,o),s.prototype.render=function(){return f(e,{accented:!0,aggregated:!0,matchHeight:!0},f(e.Title,null,f(t,null,f("span",{"data-test-aggregate-title":!0},this.props.title))),f(e.Body,null,f(r,null,f(n,null,f(i,{type:"pf",name:"ok"}),f("span",{"data-test-aggregate-ok-count":!0},this.props.ok)," "),f(n,null,f(i,{type:"pf",name:"error-circle-o"}),f("span",{"data-test-aggregate-error-count":!0},this.props.error)))))},s}(m),U=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return T(n,t),n.prototype.render=function(){return f(e,{matchHeight:!0},f(e.Body,null,f(o,null,f("div",{className:"blank-slate-pf-icon"},f("img",{src:this.props.icon,alt:this.props.name,width:46})),f(o.Title,null,this.props.name),f(o.Info,null,this.props.description))))},n}(m),B=function(t){return f(e,{matchHeight:!0},f(e.Body,null,f(o,null,f(b,L({height:300,width:200,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},t),f("circle",{cx:"100",cy:"50",r:"40"}),f("rect",{x:"5",y:"125",rx:"5",ry:"5",width:"190",height:"30"}),f("rect",{x:"25",y:"180",rx:"5",ry:"5",width:"150",height:"15"}),f("rect",{x:"40",y:"205",rx:"5",ry:"5",width:"120",height:"15"})))))},H=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return T(n,t),n.prototype.render=function(){return f(s,{fluid:!0,matchHeight:!0},f(s.Row,null,this.props.loading?new Array(5).fill(0).map(function(t,n){return f(s.Col,{sm:6,md:3,key:n},f(B,{key:n}))}):this.props.children.map(function(t,n){return f(s.Col,{sm:6,md:3,key:n},t)})))},n}(x),j=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return T(n,t),n.prototype.render=function(){return f("div",null,f("div",null,this.props.value," ( ",this.props.currentStep," /"," ",this.props.totalSteps," )"),f(a,{now:this.props.currentStep,max:this.props.totalSteps,style:{height:6}}))},n}(m),E=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return T(n,t),n.prototype.render=function(){return f(l,null,this.props.children)},n}(x),V=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return T(n,t),n.prototype.render=function(){var t="Published"===this.props.currentState||"Pending"===this.props.currentState?"primary":"default",n="Pending";switch(this.props.currentState){case"Published":n="Published";break;case"Unpublished":n="Unpublished"}return f(p,{type:t},n)},n}(x),q=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return T(n,t),n.prototype.render=function(){var t="Pending";switch(this.props.targetState){case"Published":t="Starting...";break;case"Unpublished":t="Stopping..."}return f("div",{className:"integration-status-detail"},this.props.value&&this.props.currentStep&&this.props.totalSteps?f(j,{currentStep:this.props.currentStep,totalSteps:this.props.totalSteps,value:this.props.value}):f(w,null,f(u,{loading:!0,inline:!0}),t))},n}(x),K=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return T(n,t),n.prototype.render=function(){return f(l.Item,{actions:f("div",null,"Pending"===this.props.currentState?f(q,{targetState:this.props.targetState,value:this.props.monitoringValue,currentStep:this.props.monitoringCurrentStep,totalSteps:this.props.monitoringTotalSteps}):f(V,{currentState:this.props.currentState}),f(c,{id:"integration-"+this.props.integrationId+"-action-menu",pullRight:!0},f(h,null,"Action 2"))),heading:this.props.integrationName,description:this.props.isConfigurationRequired?f(w,null,f(i,{type:"pf",name:"warning-triangle-o"}),"Configuration Required"):"",hideCloseIcon:!0,leftContent:f(l.Icon,{name:"gear"}),stacked:!1})},n}(x),z=function(t){var n=t.width;return f(b,{height:356,width:n,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",style:t.style},f("circle",{cx:"30",cy:"40",r:"16"}),f("circle",{cx:"70",cy:"40",r:"16"}),f("rect",{x:"105",y:"35",rx:"5",ry:"5",width:"200",height:"15"}),f("rect",{x:n-100,y:"35",rx:"5",ry:"5",width:"80",height:"15"}),f("circle",{cx:"30",cy:"110",r:"16"}),f("circle",{cx:"70",cy:"110",r:"16"}),f("rect",{x:"105",y:"105",rx:"5",ry:"5",width:"180",height:"15"}),f("rect",{x:n-100,y:"105",rx:"5",ry:"5",width:"80",height:"15"}),f("circle",{cx:"30",cy:"180",r:"16"}),f("circle",{cx:"70",cy:"180",r:"16"}),f("rect",{x:"105",y:"175",rx:"5",ry:"5",width:"195",height:"15"}),f("rect",{x:n-100,y:"175",rx:"5",ry:"5",width:"85",height:"15"}),f("circle",{cx:"30",cy:"250",r:"16"}),f("circle",{cx:"70",cy:"250",r:"16"}),f("rect",{x:"105",y:"245",rx:"5",ry:"5",width:"225",height:"15"}),f("rect",{x:n-100,y:"245",rx:"5",ry:"5",width:"85",height:"15"}),f("circle",{cx:"30",cy:"320",r:"16"}),f("circle",{cx:"70",cy:"320",r:"16"}),f("rect",{x:"105",y:"315",rx:"5",ry:"5",width:"165",height:"15"}),f("rect",{x:n-100,y:"315",rx:"5",ry:"5",width:"85",height:"15"}))},M=function(){return f(o,null,f(o.Icon,null),f(o.Title,null,"Something is wrong"),f(o.Info,null,"An error occurred while talking with the server."),f(o.Help,null,"Please check your internet connection."),f(o.Action,null,f("a",{href:".",className:"btn btn-lg btn-primary"},"Refresh")))},F=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}T(n,t),n.prototype.render=function(){return this.props.error||this.props.timedOut?f(M,null):this.props.pastDelay?f("div",{className:"ModuleLoader"},f(u,{loading:!0,size:"lg"})):null}}(x),function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return N(r,n),r.prototype.render=function(){return f(e,{accented:!0,aggregated:!0,matchHeight:!0},f(e.Title,null,f(t,null,this.props.count)," ","Connections"))},r}(m)),G=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return N(n,t),n.prototype.render=function(){var t={colors:{Pending:g.pfPaletteColors.black200,Published:g.pfPaletteColors.blue400,Stopped:g.pfPaletteColors.black300},columns:[["Running",this.props.runningIntegrations],["Stopped",this.props.stoppedIntegrations],["Pending",this.props.pendingIntegrations]],type:"donut"};return f(e,null,f(e.Heading,null,f(e.Title,null,"Integration Board")),f(e.Body,null,f(d,{id:"integration-board",size:{height:120},data:t,tooltip:{contents:g.pfDonutTooltipContents,show:!0},title:{type:"total",secondary:"Integrations"},legend:{show:!0,position:"right"}})))},n}(m),J=function(t){return f(b,O({height:150,width:350,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},t),f("rect",{x:"20",y:"5",rx:"5",ry:"5",width:"100",height:"10"}),f("rect",{x:"150",y:"5",rx:"5",ry:"5",width:"30",height:"10"}),f("rect",{x:"250",y:"5",rx:"5",ry:"5",width:"40",height:"10"}),f("rect",{x:"20",y:"35",rx:"5",ry:"5",width:"80",height:"10"}),f("rect",{x:"150",y:"35",rx:"5",ry:"5",width:"30",height:"10"}),f("rect",{x:"250",y:"35",rx:"5",ry:"5",width:"40",height:"10"}),f("rect",{x:"20",y:"65",rx:"5",ry:"5",width:"95",height:"10"}),f("rect",{x:"150",y:"65",rx:"5",ry:"5",width:"30",height:"10"}),f("rect",{x:"250",y:"65",rx:"5",ry:"5",width:"40",height:"10"}),f("rect",{x:"20",y:"95",rx:"5",ry:"5",width:"125",height:"10"}),f("rect",{x:"150",y:"95",rx:"5",ry:"5",width:"30",height:"10"}),f("rect",{x:"250",y:"95",rx:"5",ry:"5",width:"40",height:"10"}),f("rect",{x:"20",y:"125",rx:"5",ry:"5",width:"65",height:"10"}),f("rect",{x:"150",y:"125",rx:"5",ry:"5",width:"30",height:"10"}),f("rect",{x:"250",y:"125",rx:"5",ry:"5",width:"40",height:"10"}))},Q=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return N(n,t),n.prototype.render=function(){return f(e,{accented:!1},f(e.Heading,null,f(e.Title,null,"Recent Updates")),f(e.Body,null,this.props.loading?f(J,null):f(y,{fluid:!0},this.props.recentlyUpdatedIntegrations.map(function(t){return f(y.Row,{key:t.id},f(y.Col,{sm:5},t.name),f(y.Col,{sm:3},f(V,{currentState:t.currentState})),f(y.Col,{sm:4},new Date(t.updatedAt||t.createdAt).toLocaleString()))}))))},n}(x),W=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return N(n,t),n.prototype.render=function(){return f(e,{accented:!1,className:"TopIntegrations"},f(e.Heading,null,f(e.DropdownButton,{id:"cardDropdownButton1",title:"Last 30 Days"},f(h,{eventKey:"1",active:!0},"Last 30 Days"),f(h,{eventKey:"2"},"Last 60 Days"),f(h,{eventKey:"3"},"Last 90 Days")),f(e.Title,null,"Top 5 Integrations")),f(e.Body,null,this.props.loading?f(z,{width:500}):f(E,null,this.props.topIntegrations.map(function(t,n){return f(K,{integrationId:t.integration.id,integrationName:t.integration.name,currentState:t.integration.currentState,targetState:t.integration.targetState,isConfigurationRequired:!!(t.integration.board.warnings||t.integration.board.errors||t.integration.board.notices),monitoringValue:t.monitoring&&t.monitoring.detailedState.value,monitoringCurrentStep:t.monitoring&&t.monitoring.detailedState.currentStep,monitoringTotalSteps:t.monitoring&&t.monitoring.detailedState.totalSteps,key:n})}))))},n}(x),X=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return N(n,t),n.prototype.render=function(){var t=new Date(this.props.start).toLocaleString();return f(e,{accented:!0,aggregated:!0,matchHeight:!0},f(e.Title,{className:"text-left"},f("small",{className:"pull-right"},"since ",t),f("div",null,"Uptime")),f(e.Body,null,"TODO"))},n}(m),Y=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return N(n,t),n.prototype.render=function(){return f("div",{className:"container-fluid"},f(y,{fluid:!0},f(y.Row,null,f(y.Col,{sm:12},f("div",{className:"Dashboard-header"},f("h1",{className:"Dashboard-header__title"},"System metric"),f("div",{className:"Dashboard-header__actions"},f(v,{to:"/integrations"},"View All Integrations"),f(v,{to:"/integrations/new",className:"btn btn-primary"},"Create Integration")))))),f(s,{fluid:!0,matchHeight:!0},f(s.Row,null,f(s.Col,{sm:6,md:3},f(A,{title:this.props.integrationsCount+" Integrations",ok:this.props.integrationsCount-this.props.integrationsErrorCount,error:this.props.integrationsErrorCount})),f(s.Col,{sm:6,md:3},f(F,{count:this.props.connectionsCount})),f(s.Col,{sm:6,md:3},f(A,{title:this.props.metrics.messages+" Total Messages",ok:this.props.metrics.messages-this.props.metrics.errors,error:this.props.metrics.errors})),f(s.Col,{sm:6,md:3},f(X,{start:this.props.metrics.start})))),f(y,{fluid:!0},f(y.Row,null,f(y.Col,{sm:12,md:6},f(W,{loading:!this.props.integrationsLoaded,topIntegrations:this.props.topIntegrations})),f(y.Col,{sm:12,md:6},f(y.Row,null,f(y.Col,{sm:12},f(G,{runningIntegrations:this.props.runningIntegrations,pendingIntegrations:this.props.pendingIntegrations,stoppedIntegrations:this.props.stoppedIntegrations}))),f(y.Row,null,f(y.Col,{sm:12},f(Q,{loading:!this.props.integrationsLoaded,recentlyUpdatedIntegrations:this.props.recentlyUpdatedIntegrations})))))),f(y,{fluid:!0,style:{marginTop:"20px"}},f(y.Row,null,f(y.Col,{sm:12},f("div",{className:"Dashboard-header"},f("h1",{className:"Dashboard-header__title"},"Connections"),f("div",{className:"Dashboard-header__actions"},f(v,{to:"/connections"},"View All Connections"),f(v,{to:"/connections/new",className:"btn btn-primary"},"Create Connection")))))),f(H,{loading:!this.props.connectionsLoaded},this.props.connections.map(function(t,n){return f(U,{name:t.name,description:t.description||"",icon:C(t,process.env.PUBLIC_URL),key:n})})))},n}(x);function Z(t){return 0!==t.updatedAt?t.updatedAt:t.createdAt}function $(t,n){var r=Z(t);return Z(n)-r}function tt(){return f(P,null,function(t){var n=t.data,r=t.hasData;return f(I,null,function(t){var e=t.data,i=t.hasData;return f(S,null,function(t){var o=t.data,s=t.hasData,a=n.items.reduce(function(t,n){var r;return O({},t,((r={})[n.integration.currentState]=(t[n.integration.currentState]||0)+1,r))},{Error:0,Pending:0,Published:0,Unpublished:0});return f(Y,{integrationsLoaded:r,connectionsLoaded:s,metricsLoaded:i,integrationsCount:n.totalCount,integrationsErrorCount:a.Error,connections:o.items,connectionsCount:o.totalCount,metrics:e,runningIntegrations:a.Published,stoppedIntegrations:a.Unpublished,pendingIntegrations:a.Pending,recentlyUpdatedIntegrations:function(t){return t.map(function(t){return t.integration}).sort($).slice(0,5)}(n.items),topIntegrations:function(t,n){void 0===n&&(n={});var r=Object.keys(n).map(function(t){return{count:n[t],id:t}}).sort(function(t,n){return n.count-t.count});return t.sort(function(t,n){return $(t.integration,n.integration)}).sort(function(t,n){var e=r.findIndex(function(t){return t.id===n.integration.id});return-1===e?r.length+1:e}).reverse().slice(0,5)}(n.items,e.topIntegrations)})})})})}export default(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return N(n,t),n.prototype.render=function(){return f(k,null,f(_,{path:this.props.mountpoint,exact:!0,component:tt}))},n}(x));
//# sourceMappingURL=dashboard.mjs.map
