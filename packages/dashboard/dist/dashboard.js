var e,t=require("patternfly-react"),r=require("react"),n=(e=require("react-content-loader"))&&"object"==typeof e&&"default"in e?e.default:e,i=require("@syndesis/utils"),a=require("react-router-dom"),o=require("@syndesis/api"),l=require("react-router"),c=function(e,t){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function s(e,t){function r(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var p=function(){return(p=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function m(e,t){function r(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var d=function(){return(d=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},h=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return m(n,e),n.prototype.render=function(){return r.createElement(t.Card,{accented:!0,aggregated:!0,matchHeight:!0},r.createElement(t.Card.Title,null,r.createElement(t.AggregateStatusCount,null,r.createElement("span",{"data-test-aggregate-title":!0},this.props.title))),r.createElement(t.Card.Body,null,r.createElement(t.AggregateStatusNotifications,null,r.createElement(t.AggregateStatusNotification,null,r.createElement(t.Icon,{type:"pf",name:"ok"}),r.createElement("span",{"data-test-aggregate-ok-count":!0},this.props.ok)," "),r.createElement(t.AggregateStatusNotification,null,r.createElement(t.Icon,{type:"pf",name:"error-circle-o"}),r.createElement("span",{"data-test-aggregate-error-count":!0},this.props.error)))))},n}(r.PureComponent),g=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return m(n,e),n.prototype.render=function(){return r.createElement(t.Card,{matchHeight:!0},r.createElement(t.Card.Body,null,r.createElement(t.EmptyState,null,r.createElement("div",{className:"blank-slate-pf-icon"},r.createElement("img",{src:this.props.icon,alt:this.props.name,width:46})),r.createElement(t.EmptyState.Title,null,this.props.name),r.createElement(t.EmptyState.Info,null,this.props.description))))},n}(r.PureComponent),E=function(e){return r.createElement(t.Card,{matchHeight:!0},r.createElement(t.Card.Body,null,r.createElement(t.EmptyState,null,r.createElement(n,d({height:300,width:200,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},e),r.createElement("circle",{cx:"100",cy:"50",r:"40"}),r.createElement("rect",{x:"5",y:"125",rx:"5",ry:"5",width:"190",height:"30"}),r.createElement("rect",{x:"25",y:"180",rx:"5",ry:"5",width:"150",height:"15"}),r.createElement("rect",{x:"40",y:"205",rx:"5",ry:"5",width:"120",height:"15"})))))},y=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return m(n,e),n.prototype.render=function(){return r.createElement(t.CardGrid,{fluid:!0,matchHeight:!0},r.createElement(t.CardGrid.Row,null,this.props.loading?new Array(5).fill(0).map(function(e,n){return r.createElement(t.CardGrid.Col,{sm:6,md:3,key:n},r.createElement(E,{key:n}))}):this.props.children.map(function(e,n){return r.createElement(t.CardGrid.Col,{sm:6,md:3,key:n},e)})))},n}(r.Component),f=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return m(n,e),n.prototype.render=function(){return r.createElement("div",null,r.createElement("div",null,this.props.value," ( ",this.props.currentStep," /"," ",this.props.totalSteps," )"),r.createElement(t.ProgressBar,{now:this.props.currentStep,max:this.props.totalSteps,style:{height:6}}))},n}(r.PureComponent),C=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return m(n,e),n.prototype.render=function(){return r.createElement(t.ListView,null,this.props.children)},n}(r.Component),x=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return m(n,e),n.prototype.render=function(){var e="Published"===this.props.currentState||"Pending"===this.props.currentState?"primary":"default",n="Pending";switch(this.props.currentState){case"Published":n="Published";break;case"Unpublished":n="Unpublished"}return r.createElement(t.Label,{type:e},n)},n}(r.Component),w=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return m(n,e),n.prototype.render=function(){var e="Pending";switch(this.props.targetState){case"Published":e="Starting...";break;case"Unpublished":e="Stopping..."}return r.createElement("div",{className:"integration-status-detail"},this.props.value&&this.props.currentStep&&this.props.totalSteps?r.createElement(f,{currentStep:this.props.currentStep,totalSteps:this.props.totalSteps,value:this.props.value}):r.createElement(r.Fragment,null,r.createElement(t.Spinner,{loading:!0,inline:!0}),e))},n}(r.Component),S=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return m(n,e),n.prototype.render=function(){return r.createElement(t.ListView.Item,{actions:r.createElement("div",null,"Pending"===this.props.currentState?r.createElement(w,{targetState:this.props.targetState,value:this.props.monitoringValue,currentStep:this.props.monitoringCurrentStep,totalSteps:this.props.monitoringTotalSteps}):r.createElement(x,{currentState:this.props.currentState}),r.createElement(t.DropdownKebab,{id:"integration-"+this.props.integrationId+"-action-menu",pullRight:!0},r.createElement(t.MenuItem,null,"Action 2"))),heading:this.props.integrationName,description:this.props.isConfigurationRequired?r.createElement(r.Fragment,null,r.createElement(t.Icon,{type:"pf",name:"warning-triangle-o"}),"Configuration Required"):"",hideCloseIcon:!0,leftContent:r.createElement(t.ListView.Icon,{name:"gear"}),stacked:!1})},n}(r.Component),b=function(e){var t=e.width;return r.createElement(n,{height:356,width:t,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb",style:e.style},r.createElement("circle",{cx:"30",cy:"40",r:"16"}),r.createElement("circle",{cx:"70",cy:"40",r:"16"}),r.createElement("rect",{x:"105",y:"35",rx:"5",ry:"5",width:"200",height:"15"}),r.createElement("rect",{x:t-100,y:"35",rx:"5",ry:"5",width:"80",height:"15"}),r.createElement("circle",{cx:"30",cy:"110",r:"16"}),r.createElement("circle",{cx:"70",cy:"110",r:"16"}),r.createElement("rect",{x:"105",y:"105",rx:"5",ry:"5",width:"180",height:"15"}),r.createElement("rect",{x:t-100,y:"105",rx:"5",ry:"5",width:"80",height:"15"}),r.createElement("circle",{cx:"30",cy:"180",r:"16"}),r.createElement("circle",{cx:"70",cy:"180",r:"16"}),r.createElement("rect",{x:"105",y:"175",rx:"5",ry:"5",width:"195",height:"15"}),r.createElement("rect",{x:t-100,y:"175",rx:"5",ry:"5",width:"85",height:"15"}),r.createElement("circle",{cx:"30",cy:"250",r:"16"}),r.createElement("circle",{cx:"70",cy:"250",r:"16"}),r.createElement("rect",{x:"105",y:"245",rx:"5",ry:"5",width:"225",height:"15"}),r.createElement("rect",{x:t-100,y:"245",rx:"5",ry:"5",width:"85",height:"15"}),r.createElement("circle",{cx:"30",cy:"320",r:"16"}),r.createElement("circle",{cx:"70",cy:"320",r:"16"}),r.createElement("rect",{x:"105",y:"315",rx:"5",ry:"5",width:"165",height:"15"}),r.createElement("rect",{x:t-100,y:"315",rx:"5",ry:"5",width:"85",height:"15"}))},v=function(){return r.createElement(t.EmptyState,null,r.createElement(t.EmptyState.Icon,null),r.createElement(t.EmptyState.Title,null,"Something is wrong"),r.createElement(t.EmptyState.Info,null,"An error occurred while talking with the server."),r.createElement(t.EmptyState.Help,null,"Please check your internet connection."),r.createElement(t.EmptyState.Action,null,r.createElement("a",{href:".",className:"btn btn-lg btn-primary"},"Refresh")))},I=(function(e){function n(){return null!==e&&e.apply(this,arguments)||this}m(n,e),n.prototype.render=function(){return this.props.error||this.props.timedOut?r.createElement(v,null):this.props.pastDelay?r.createElement("div",{className:"ModuleLoader"},r.createElement(t.Spinner,{loading:!0,size:"lg"})):null}}(r.Component),function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return s(n,e),n.prototype.render=function(){return r.createElement(t.Card,{accented:!0,aggregated:!0,matchHeight:!0},r.createElement(t.Card.Title,null,r.createElement(t.AggregateStatusCount,null,this.props.count)," ","Connections"))},n}(r.PureComponent)),P=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return s(n,e),n.prototype.render=function(){var e={colors:{Pending:t.patternfly.pfPaletteColors.black200,Published:t.patternfly.pfPaletteColors.blue400,Stopped:t.patternfly.pfPaletteColors.black300},columns:[["Running",this.props.runningIntegrations],["Stopped",this.props.stoppedIntegrations],["Pending",this.props.pendingIntegrations]],type:"donut"};return r.createElement(t.Card,null,r.createElement(t.Card.Heading,null,r.createElement(t.Card.Title,null,"Integration Board")),r.createElement(t.Card.Body,null,r.createElement(t.DonutChart,{id:"integration-board",size:{height:120},data:e,tooltip:{contents:t.patternfly.pfDonutTooltipContents,show:!0},title:{type:"total",secondary:"Integrations"},legend:{show:!0,position:"right"}})))},n}(r.PureComponent),G=function(e){return r.createElement(n,p({height:150,width:350,speed:2,primaryColor:"#f3f3f3",secondaryColor:"#ecebeb"},e),r.createElement("rect",{x:"20",y:"5",rx:"5",ry:"5",width:"100",height:"10"}),r.createElement("rect",{x:"150",y:"5",rx:"5",ry:"5",width:"30",height:"10"}),r.createElement("rect",{x:"250",y:"5",rx:"5",ry:"5",width:"40",height:"10"}),r.createElement("rect",{x:"20",y:"35",rx:"5",ry:"5",width:"80",height:"10"}),r.createElement("rect",{x:"150",y:"35",rx:"5",ry:"5",width:"30",height:"10"}),r.createElement("rect",{x:"250",y:"35",rx:"5",ry:"5",width:"40",height:"10"}),r.createElement("rect",{x:"20",y:"65",rx:"5",ry:"5",width:"95",height:"10"}),r.createElement("rect",{x:"150",y:"65",rx:"5",ry:"5",width:"30",height:"10"}),r.createElement("rect",{x:"250",y:"65",rx:"5",ry:"5",width:"40",height:"10"}),r.createElement("rect",{x:"20",y:"95",rx:"5",ry:"5",width:"125",height:"10"}),r.createElement("rect",{x:"150",y:"95",rx:"5",ry:"5",width:"30",height:"10"}),r.createElement("rect",{x:"250",y:"95",rx:"5",ry:"5",width:"40",height:"10"}),r.createElement("rect",{x:"20",y:"125",rx:"5",ry:"5",width:"65",height:"10"}),r.createElement("rect",{x:"150",y:"125",rx:"5",ry:"5",width:"30",height:"10"}),r.createElement("rect",{x:"250",y:"125",rx:"5",ry:"5",width:"40",height:"10"}))},_=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return s(n,e),n.prototype.render=function(){return r.createElement(t.Card,{accented:!1},r.createElement(t.Card.Heading,null,r.createElement(t.Card.Title,null,"Recent Updates")),r.createElement(t.Card.Body,null,this.props.loading?r.createElement(G,null):r.createElement(t.Grid,{fluid:!0},this.props.recentlyUpdatedIntegrations.map(function(e){return r.createElement(t.Grid.Row,{key:e.id},r.createElement(t.Grid.Col,{sm:5},e.name),r.createElement(t.Grid.Col,{sm:3},r.createElement(x,{currentState:e.currentState})),r.createElement(t.Grid.Col,{sm:4},new Date(e.updatedAt||e.createdAt).toLocaleString()))}))))},n}(r.Component),k=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return s(n,e),n.prototype.render=function(){return r.createElement(t.Card,{accented:!1,className:"TopIntegrations"},r.createElement(t.Card.Heading,null,r.createElement(t.Card.DropdownButton,{id:"cardDropdownButton1",title:"Last 30 Days"},r.createElement(t.MenuItem,{eventKey:"1",active:!0},"Last 30 Days"),r.createElement(t.MenuItem,{eventKey:"2"},"Last 60 Days"),r.createElement(t.MenuItem,{eventKey:"3"},"Last 90 Days")),r.createElement(t.Card.Title,null,"Top 5 Integrations")),r.createElement(t.Card.Body,null,this.props.loading?r.createElement(b,{width:500}):r.createElement(C,null,this.props.topIntegrations.map(function(e,t){return r.createElement(S,{integrationId:e.integration.id,integrationName:e.integration.name,currentState:e.integration.currentState,targetState:e.integration.targetState,isConfigurationRequired:!!(e.integration.board.warnings||e.integration.board.errors||e.integration.board.notices),monitoringValue:e.monitoring&&e.monitoring.detailedState.value,monitoringCurrentStep:e.monitoring&&e.monitoring.detailedState.currentStep,monitoringTotalSteps:e.monitoring&&e.monitoring.detailedState.totalSteps,key:t})}))))},n}(r.Component),L=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return s(n,e),n.prototype.render=function(){var e=new Date(this.props.start).toLocaleString();return r.createElement(t.Card,{accented:!0,aggregated:!0,matchHeight:!0},r.createElement(t.Card.Title,{className:"text-left"},r.createElement("small",{className:"pull-right"},"since ",e),r.createElement("div",null,"Uptime")),r.createElement(t.Card.Body,null,"TODO"))},n}(r.PureComponent),D=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return s(n,e),n.prototype.render=function(){return r.createElement("div",{className:"container-fluid"},r.createElement(t.Grid,{fluid:!0},r.createElement(t.Grid.Row,null,r.createElement(t.Grid.Col,{sm:12},r.createElement("div",{className:"Dashboard-header"},r.createElement("h1",{className:"Dashboard-header__title"},"System metric"),r.createElement("div",{className:"Dashboard-header__actions"},r.createElement(a.Link,{to:"/integrations"},"View All Integrations"),r.createElement(a.Link,{to:"/integrations/new",className:"btn btn-primary"},"Create Integration")))))),r.createElement(t.CardGrid,{fluid:!0,matchHeight:!0},r.createElement(t.CardGrid.Row,null,r.createElement(t.CardGrid.Col,{sm:6,md:3},r.createElement(h,{title:this.props.integrationsCount+" Integrations",ok:this.props.integrationsCount-this.props.integrationsErrorCount,error:this.props.integrationsErrorCount})),r.createElement(t.CardGrid.Col,{sm:6,md:3},r.createElement(I,{count:this.props.connectionsCount})),r.createElement(t.CardGrid.Col,{sm:6,md:3},r.createElement(h,{title:this.props.metrics.messages+" Total Messages",ok:this.props.metrics.messages-this.props.metrics.errors,error:this.props.metrics.errors})),r.createElement(t.CardGrid.Col,{sm:6,md:3},r.createElement(L,{start:this.props.metrics.start})))),r.createElement(t.Grid,{fluid:!0},r.createElement(t.Grid.Row,null,r.createElement(t.Grid.Col,{sm:12,md:6},r.createElement(k,{loading:!this.props.integrationsLoaded,topIntegrations:this.props.topIntegrations})),r.createElement(t.Grid.Col,{sm:12,md:6},r.createElement(t.Grid.Row,null,r.createElement(t.Grid.Col,{sm:12},r.createElement(P,{runningIntegrations:this.props.runningIntegrations,pendingIntegrations:this.props.pendingIntegrations,stoppedIntegrations:this.props.stoppedIntegrations}))),r.createElement(t.Grid.Row,null,r.createElement(t.Grid.Col,{sm:12},r.createElement(_,{loading:!this.props.integrationsLoaded,recentlyUpdatedIntegrations:this.props.recentlyUpdatedIntegrations})))))),r.createElement(t.Grid,{fluid:!0,style:{marginTop:"20px"}},r.createElement(t.Grid.Row,null,r.createElement(t.Grid.Col,{sm:12},r.createElement("div",{className:"Dashboard-header"},r.createElement("h1",{className:"Dashboard-header__title"},"Connections"),r.createElement("div",{className:"Dashboard-header__actions"},r.createElement(a.Link,{to:"/connections"},"View All Connections"),r.createElement(a.Link,{to:"/connections/new",className:"btn btn-primary"},"Create Connection")))))),r.createElement(y,{loading:!this.props.connectionsLoaded},this.props.connections.map(function(e,t){return r.createElement(g,{name:e.name,description:e.description||"",icon:i.getConnectionIcon(e,process.env.PUBLIC_URL),key:t})})))},n}(r.Component);function N(e){return 0!==e.updatedAt?e.updatedAt:e.createdAt}function A(e,t){var r=N(e);return N(t)-r}function O(){return r.createElement(o.WithMonitoredIntegrations,null,function(e){var t=e.data,n=e.hasData;return r.createElement(o.WithIntegrationsMetrics,null,function(e){var i=e.data,a=e.hasData;return r.createElement(o.WithConnections,null,function(e){var o=e.data,l=e.hasData,c=t.items.reduce(function(e,t){var r;return p({},e,((r={})[t.integration.currentState]=(e[t.integration.currentState]||0)+1,r))},{Error:0,Pending:0,Published:0,Unpublished:0});return r.createElement(D,{integrationsLoaded:n,connectionsLoaded:l,metricsLoaded:a,integrationsCount:t.totalCount,integrationsErrorCount:c.Error,connections:o.items,connectionsCount:o.totalCount,metrics:i,runningIntegrations:c.Published,stoppedIntegrations:c.Unpublished,pendingIntegrations:c.Pending,recentlyUpdatedIntegrations:function(e){return e.map(function(e){return e.integration}).sort(A).slice(0,5)}(t.items),topIntegrations:function(e,t){void 0===t&&(t={});var r=Object.keys(t).map(function(e){return{count:t[e],id:e}}).sort(function(e,t){return t.count-e.count});return e.sort(function(e,t){return A(e.integration,t.integration)}).sort(function(e,t){var n=r.findIndex(function(e){return e.id===t.integration.id});return-1===n?r.length+1:n}).reverse().slice(0,5)}(t.items,i.topIntegrations)})})})})}var R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.render=function(){return r.createElement(l.Switch,null,r.createElement(l.Route,{path:this.props.mountpoint,exact:!0,component:O}))},t}(r.Component);module.exports=R;
//# sourceMappingURL=dashboard.js.map
