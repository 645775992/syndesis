import{createContext as t,createElement as r,Component as e}from"react";import n from"react-fast-compare";var o={apiUri:"http://example.com",token:null},i=t(o),a=function(t,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])})(t,r)};function s(t,r){function e(){this.constructor=t}a(t,r),t.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}var u=function(){return(u=Object.assign||function(t){for(var r,e=1,n=arguments.length;e<n;e++)for(var o in r=arguments[e])Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t}).apply(this,arguments)};function l(t,r){var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&r.indexOf(n)<0&&(e[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)r.indexOf(n[o])<0&&(e[n[o]]=t[n[o]])}return e}function p(t,r,e,n){return new(e||(e=Promise))(function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new e(function(r){r(t.value)}).then(a,s)}u((n=n.apply(t,r||[])).next())})}function c(t,r){var e,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(t,a)}catch(t){i=[6,t],n=0}finally{e=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function h(t){var r=t.method,e=t.headers,n=void 0===e?{}:e,o=t.body,i=t.contentType,a=void 0===i?"application/json; charset=utf-8":i;return fetch(t.url,{body:o?JSON.stringify(o):void 0,cache:"no-cache",credentials:"include",headers:u({"Content-Type":a},n),method:r,mode:"cors",redirect:"follow",referrer:"no-referrer"})}var d=function(t){function r(r){var e=t.call(this,r)||this;return e.state={data:e.props.defaultValue,error:!1,hasData:!1,loading:!0,read:e.read,save:e.onSave},e.poller=e.poller.bind(e),e}return s(r,t),r.prototype.componentDidMount=function(){return p(this,void 0,void 0,function(){return c(this,function(t){return this.props.autoload&&(this.read(),this.props.poll&&this.startPolling()),[2]})})},r.prototype.componentDidUpdate=function(t){return p(this,void 0,void 0,function(){return c(this,function(r){return t.url!==this.props.url&&this.read(),t.poll!==this.props.poll&&(this.props.poll?this.startPolling():this.stopPolling()),[2]})})},r.prototype.componentWillUnmount=function(){this.stopPolling()},r.prototype.shouldComponentUpdate=function(t,r){return!n(this.props,t)||!n(this.state,r)},r.prototype.render=function(){return this.props.children(this.state)},r.prototype.read=function(){return p(this,void 0,void 0,function(){var t,r,e;return c(this,function(n){switch(n.label){case 0:return n.trys.push([0,6,,7]),this.setState({loading:!0}),[4,h({contentType:this.props.contentType,headers:this.props.headers,method:"GET",url:""+this.props.baseUrl+this.props.url})];case 1:if(!(t=n.sent()).ok)throw new Error(t.statusText);return r=void 0,this.props.contentType&&0!==this.props.contentType.indexOf("application/json")?[3,3]:[4,t.json()];case 2:return r=n.sent(),[3,5];case 3:return[4,t.text()];case 4:r=n.sent(),n.label=5;case 5:return this.setState({data:r,hasData:!0,loading:!1}),[3,7];case 6:return e=n.sent(),this.setState({data:this.props.defaultValue,error:!0,errorMessage:e.message,hasData:!1,loading:!1}),[3,7];case 7:return[2]}})})},r.prototype.onSave=function(t){var r=t.url,e=t.data;return p(this,void 0,void 0,function(){var t,n,o=this;return c(this,function(i){switch(i.label){case 0:this.setState({loading:!0}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,h({body:e,contentType:this.props.contentType,headers:this.props.headers,method:"PUT",url:""+this.props.baseUrl+(r||this.props.url)})];case 2:if(!(t=i.sent()).ok)throw new Error(t.statusText);return setTimeout(function(){return o.read()},5e3),[3,4];case 3:return n=i.sent(),this.setState({error:!0,errorMessage:n.message,loading:!1}),[3,4];case 4:return[2]}})})},r.prototype.startPolling=function(){this.stopPolling(),this.pollingTimer=setInterval(this.poller,this.props.poll)},r.prototype.poller=function(){this.state.loading||this.read()},r.prototype.stopPolling=function(){this.pollingTimer&&(clearInterval(this.pollingTimer),this.pollingTimer=void 0)},r.defaultProps={autoload:!0},r}(e),f=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.read=function(){return p(r,void 0,void 0,function(){var t=this;return c(this,function(r){try{this.setState({loading:!0}),h({contentType:this.props.contentType,headers:this.props.headers,method:"GET",url:""+this.props.baseUrl+this.props.url}).then(function(t){return t.body}).then(function(r){t.reader=r.getReader();var e=new TextDecoder("utf-8"),n=function(r){var o=r.value;r.done?t.setState({loading:!1}):(t.setState({data:(t.state.data||[]).concat([e.decode(o)])}),t.reader.read().then(n))};t.reader.read().then(n)})}catch(t){this.setState({error:!0,errorMessage:t.message,loading:!1})}return[2]})})},r.onSave=function(){return p(r,void 0,void 0,function(){return c(this,function(t){throw new Error("Can't save from a stream")})})},r}return s(r,t),r.prototype.componentDidUpdate=function(t){return p(this,void 0,void 0,function(){return c(this,function(r){return t.url!==this.props.url&&(this.reader&&this.reader.cancel(),this.read()),[2]})})},r.prototype.componentWillUnmount=function(){this.reader&&this.reader.cancel()},r}(d),y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.render=function(){var t=this.props,e=t.url,n=t.stream,o=l(t,["url","stream"]),a=n?f:d;return r(i.Consumer,null,function(t){return r(a,u({baseUrl:t.apiUri,url:e},o,{headers:{"SYNDESIS-XSRF-TOKEN":"awesome","X-Forwarded-Access-Token":""+t.token,"X-Forwarded-User":"admin"}}))})},e}(e),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.render=function(){var t=this;return r(y,{url:"/api/v1/integrations",poll:5e3,defaultValue:{items:[],totalCount:0}},function(r){return t.props.children(r)})},e}(e),m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.render=function(){var t=this;return r(v,null,function(e){var n=e.data,o=l(e,["data"]);return r(y,{url:"/api/v1/monitoring/integrations",poll:5e3,defaultValue:[]},function(r){var e=r.data;return t.props.children(u({},o,{data:{items:n.items.map(function(t){return{integration:t,monitoring:e.find(function(r){return r.integrationId===t.id})}}),totalCount:n.totalCount}}))})})},e}(e),g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.render=function(){var t=this;return r(y,{url:"/api/v1/metrics/integrations",poll:5e3,defaultValue:{errors:0,lastProcessed:0,messages:0,metricsProvider:"",start:0,topIntegrations:{}}},function(r){return t.props.children(r)})},e}(e),b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.render=function(){var t=this;return r(y,{url:"/api/v1/connections",poll:5e3,defaultValue:{items:[],totalCount:0}},function(r){return t.props.children(r)})},e}(e);export{o as ApiContextDefaultValue,i as ApiContext,y as SyndesisRest,h as callFetch,d as Rest,f as Stream,v as WithIntegrations,m as WithMonitoredIntegrations,g as WithIntegrationsMetrics,b as WithConnections};
//# sourceMappingURL=api.mjs.map
