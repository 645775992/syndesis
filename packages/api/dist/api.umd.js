!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("react-fast-compare")):"function"==typeof define&&define.amd?define(["exports","react","react-fast-compare"],e):e(t.api={},t.react,t.equal)}(this,function(t,e,r){r=r&&r.hasOwnProperty("default")?r.default:r;var n={apiUri:"http://example.com",token:null},o=e.createContext(n),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function a(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var s=function(){return(s=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function u(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&(r[n[o]]=t[n[o]])}return r}function l(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{u(n.next(t))}catch(t){i(t)}}function s(t){try{u(n.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new r(function(e){e(t.value)}).then(a,s)}u((n=n.apply(t,e||[])).next())})}function p(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function c(t){var e=t.method,r=t.headers,n=void 0===r?{}:r,o=t.body,i=t.contentType,a=void 0===i?"application/json; charset=utf-8":i;return fetch(t.url,{body:o?JSON.stringify(o):void 0,cache:"no-cache",credentials:"include",headers:s({"Content-Type":a},n),method:e,mode:"cors",redirect:"follow",referrer:"no-referrer"})}var h=function(t){function e(e){var r=t.call(this,e)||this;return r.state={data:r.props.defaultValue,error:!1,hasData:!1,loading:!0,read:r.read,save:r.onSave},r.poller=r.poller.bind(r),r}return a(e,t),e.prototype.componentDidMount=function(){return l(this,void 0,void 0,function(){return p(this,function(t){return this.props.autoload&&(this.read(),this.props.poll&&this.startPolling()),[2]})})},e.prototype.componentDidUpdate=function(t){return l(this,void 0,void 0,function(){return p(this,function(e){return t.url!==this.props.url&&this.read(),t.poll!==this.props.poll&&(this.props.poll?this.startPolling():this.stopPolling()),[2]})})},e.prototype.componentWillUnmount=function(){this.stopPolling()},e.prototype.shouldComponentUpdate=function(t,e){return!r(this.props,t)||!r(this.state,e)},e.prototype.render=function(){return this.props.children(this.state)},e.prototype.read=function(){return l(this,void 0,void 0,function(){var t,e,r;return p(this,function(n){switch(n.label){case 0:return n.trys.push([0,6,,7]),this.setState({loading:!0}),[4,c({contentType:this.props.contentType,headers:this.props.headers,method:"GET",url:""+this.props.baseUrl+this.props.url})];case 1:if(!(t=n.sent()).ok)throw new Error(t.statusText);return e=void 0,this.props.contentType&&0!==this.props.contentType.indexOf("application/json")?[3,3]:[4,t.json()];case 2:return e=n.sent(),[3,5];case 3:return[4,t.text()];case 4:e=n.sent(),n.label=5;case 5:return this.setState({data:e,hasData:!0,loading:!1}),[3,7];case 6:return r=n.sent(),this.setState({data:this.props.defaultValue,error:!0,errorMessage:r.message,hasData:!1,loading:!1}),[3,7];case 7:return[2]}})})},e.prototype.onSave=function(t){var e=t.url,r=t.data;return l(this,void 0,void 0,function(){var t,n,o=this;return p(this,function(i){switch(i.label){case 0:this.setState({loading:!0}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,c({body:r,contentType:this.props.contentType,headers:this.props.headers,method:"PUT",url:""+this.props.baseUrl+(e||this.props.url)})];case 2:if(!(t=i.sent()).ok)throw new Error(t.statusText);return setTimeout(function(){return o.read()},5e3),[3,4];case 3:return n=i.sent(),this.setState({error:!0,errorMessage:n.message,loading:!1}),[3,4];case 4:return[2]}})})},e.prototype.startPolling=function(){this.stopPolling(),this.pollingTimer=setInterval(this.poller,this.props.poll)},e.prototype.poller=function(){this.state.loading||this.read()},e.prototype.stopPolling=function(){this.pollingTimer&&(clearInterval(this.pollingTimer),this.pollingTimer=void 0)},e.defaultProps={autoload:!0},e}(e.Component),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.read=function(){return l(e,void 0,void 0,function(){var t=this;return p(this,function(e){try{this.setState({loading:!0}),c({contentType:this.props.contentType,headers:this.props.headers,method:"GET",url:""+this.props.baseUrl+this.props.url}).then(function(t){return t.body}).then(function(e){t.reader=e.getReader();var r=new TextDecoder("utf-8"),n=function(e){var o=e.value;e.done?t.setState({loading:!1}):(t.setState({data:(t.state.data||[]).concat([r.decode(o)])}),t.reader.read().then(n))};t.reader.read().then(n)})}catch(t){this.setState({error:!0,errorMessage:t.message,loading:!1})}return[2]})})},e.onSave=function(){return l(e,void 0,void 0,function(){return p(this,function(t){throw new Error("Can't save from a stream")})})},e}return a(e,t),e.prototype.componentDidUpdate=function(t){return l(this,void 0,void 0,function(){return p(this,function(e){return t.url!==this.props.url&&(this.reader&&this.reader.cancel(),this.read()),[2]})})},e.prototype.componentWillUnmount=function(){this.reader&&this.reader.cancel()},e}(h),f=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return a(r,t),r.prototype.render=function(){var t=this.props,r=t.url,n=t.stream,i=u(t,["url","stream"]),a=n?d:h;return e.createElement(o.Consumer,null,function(t){return e.createElement(a,s({baseUrl:t.apiUri,url:r},i,{headers:{"SYNDESIS-XSRF-TOKEN":"awesome","X-Forwarded-Access-Token":""+t.token,"X-Forwarded-User":"admin"}}))})},r}(e.Component),y=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return a(r,t),r.prototype.render=function(){var t=this;return e.createElement(f,{url:"/api/v1/integrations",poll:5e3,defaultValue:{items:[],totalCount:0}},function(e){return t.props.children(e)})},r}(e.Component),m=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return a(r,t),r.prototype.render=function(){var t=this;return e.createElement(y,null,function(r){var n=r.data,o=u(r,["data"]);return e.createElement(f,{url:"/api/v1/monitoring/integrations",poll:5e3,defaultValue:[]},function(e){var r=e.data;return t.props.children(s({},o,{data:{items:n.items.map(function(t){return{integration:t,monitoring:r.find(function(e){return e.integrationId===t.id})}}),totalCount:n.totalCount}}))})})},r}(e.Component),v=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return a(r,t),r.prototype.render=function(){var t=this;return e.createElement(f,{url:"/api/v1/metrics/integrations",poll:5e3,defaultValue:{errors:0,lastProcessed:0,messages:0,metricsProvider:"",start:0,topIntegrations:{}}},function(e){return t.props.children(e)})},r}(e.Component),g=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return a(r,t),r.prototype.render=function(){var t=this;return e.createElement(f,{url:"/api/v1/connections",poll:5e3,defaultValue:{items:[],totalCount:0}},function(e){return t.props.children(e)})},r}(e.Component);t.ApiContextDefaultValue=n,t.ApiContext=o,t.SyndesisRest=f,t.callFetch=c,t.Rest=h,t.Stream=d,t.WithIntegrations=y,t.WithMonitoredIntegrations=m,t.WithIntegrationsMetrics=v,t.WithConnections=g});
//# sourceMappingURL=api.umd.js.map
